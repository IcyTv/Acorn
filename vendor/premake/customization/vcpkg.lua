require('vstudio')

premake.api.register {
	name = "vspkg",
	scope = "config",
	kind = "boolean",
}

local vs = premake.vstudio.vc2010

local function premakeVersionComment(prj)
    premake.w('<!-- Generated by Premake ' .. _PREMAKE_VERSION .. ' -->')
end

local function vcpkg(prj)
    if prj.name == "Acorn" or prj.name == "Sandbox" or prj.name == "ImGui" or prj.name == "OakTree" then
        premake.w('<VcpkgTriplet>x64-windows-static</VcpkgTriplet>')
        premake.w('<VcpkgEnabled>true</VcpkgEnabled>')
        premake.w('<VcpkgEnableManifest>true</VcpkgEnableManifest>')
    else
        premake.w('<VcpkgEnabled>false</VcpkgEnabled>')
    end
    
end

premake.override(premake.vstudio.vc2010.elements, "project", function(base, prj)
    if prj.vcpkg then
        local calls = base(prj)
        table.insertafter(calls, vs.xmlDeclaration, premakeVersionComment)
        return calls
    end
end)


premake.override(premake.vstudio.vc2010.elements, "globals", function(base, prj)
    if prj.vcpkg then
        local calls = base(prj)
        table.insertafter(calls, vs.globals, vcpkg)
        return calls
    end
end)